<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ydl.nmis.schedule.mapper.NmisScheContrastMapper">

<!--    <resultMap type="NmisScheContrast" id="NmisScheContrastResult">
        <result property="id"    column="id"    />
        <result property="groupName"    column="group_name"    />
        <result property="deptId"    column="dept_id"    />
        <result property="deptName"    column="dept_name"    />
        <result property="delFlag"    column="del_flag"    />
        <result property="createId"    column="create_id"    />
        <result property="unitCode"    column="unit_code"    />
        <result property="seqNo"    column="seq_no"    />
        <result property="combId"    column="comb_id"    />
        <result property="scheId"    column="sche_id"    />
        <result property="scheName"    column="sche_name"    />
        <result property="scheDesc"    column="sche_desc"    />
        <result property="beginTime"    column="begin_time"    />
        <result property="endTime"    column="end_time"    />
        <result property="beginTime1"    column="begin_time1"    />
        <result property="endTime1"    column="end_time1"    />
        <result property="hours"    column="hours"    />
        <result property="classId"    column="class_id"    />
        <result property="inputCode"    column="input_code"    />
        <result property="serialNo"    column="serial_no"    />
        <result property="status"    column="status"    />
        <result property="scheColor"    column="sche_color"    />
        <result property="scheType"    column="sche_type"    />
    </resultMap>-->

    <resultMap type="NmisScheContrast" id="NmisScheContrastResult">
        <result property="id"    column="id"    />
        <result property="groupName"    column="group_name"    />
        <result property="deptId"    column="dept_id"    />
        <result property="deptName"    column="dept_name"    />
        <result property="delFlag"    column="del_flag"    />
        <result property="combId"    column="comb_id"    />
        <result property="scheName"    column="sche_name"    />
        <result property="inputCode"    column="input_code"    />
        <result property="hours"    column="hours"    />
        <result property="scheItemId"    column="sche_id"    />

    </resultMap>

    <sql id="selectNmisScheContrastVo">
        select a.id,
               a.group_name,
               a.dept_id,
               a.dept_name,
               a.del_flag,
               c.comb_id,
               c.sche_id,
               c.sche_name,
               c.input_code,
               c.hours
        from nmis.nmis_sche_comp_dict a
                 --left join nmis.nmis_sche_comb_item_dict b on a.id = b.comb_id
                 left join (select b.comb_id,
                                   listagg(c.id, ',') within group(order by c.id) as sche_id,
                       listagg(sche_name, ',') within group(order by sche_name) as sche_name,
                                listagg(input_code , ',') within group(order by input_code ) as input_code ,
                                listagg(hours , ',') within group(order by hours ) as hours
                            from nmis.nmis_sche_dict c
                                left join nmis.nmis_sche_comb_item_dict b
                            on b.sche_id = c.id
                            group by b.comb_id) c
                           on a.id = c.comb_id
    </sql>


<!--
    <sql id="selectNmisScheContrastVo">
    SELECT
    b.id,
    a.group_name,
    a.dept_id,
    a.dept_name,
    a.del_flag,
    a.create_id,
    a.unit_code,
    a.seq_no,
    a.id comb_id,
    b.sche_id,
    c.sche_name,
    c.sche_desc,
    c.begin_time,
    c.end_time,
    c.begin_time1,
    c.end_time1,
    c.hours,
    c.class_id,
    c.input_code,
    c.serial_no,
    c.status,
    c.sche_color,
    c.sche_type
    FROM
    nmis.nmis_sche_comp_dict a
    LEFT JOIN nmis.nmis_sche_comb_item_dict b ON a.id = b.comb_id
    LEFT JOIN nmis.nmis_sche_dict c ON b.sche_id = c.id
</sql>


    <select id="selectNmisScheContrastList" parameterType="NmisScheContrast" resultMap="NmisScheContrastResult">
        <include refid="selectNmisScheContrastVo"/>
        <where>
            <if test="id != null  and id != ''"> and b.id = #{id}</if>
            <if test="groupName != null  and groupName != ''"> and a.group_name like concat(concat('%', #{groupName}), '%')</if>
            <if test="deptId != null  and deptId != ''"> and a.dept_id = #{deptId}</if>
            <if test="deptName != null  and deptName != ''"> and a.dept_name like concat('%', #{deptName}, '%')</if>
            <if test="createId != null  and createId != ''"> and a.create_id = #{createId}</if>
            <if test="unitCode != null  and unitCode != ''"> and a.unit_code = #{unitCode}</if>
            <if test="seqNo != null "> and a.seq_no = #{seqNo}</if>
            <if test="combId != null "> and a.id = #{combId}</if>
            <if test="scheId != null "> and b.sche_id = #{scheId}</if>
            <if test="scheName != null  and scheName != ''"> and sche_name like concat(concat('%', #{scheName}), '%')</if>
            <if test="scheDesc != null  and scheDesc != ''"> and sche_desc = #{scheDesc}</if>
            <if test="beginTime != null  and beginTime != ''"> and begin_time = #{beginTime}</if>
            <if test="endTime != null  and endTime != ''"> and end_time = #{endTime}</if>
            <if test="beginTime1 != null  and beginTime1 != ''"> and begin_time1 = #{beginTime1}</if>
            <if test="endTime1 != null  and endTime1 != ''"> and end_time1 = #{endTime1}</if>
            <if test="hours != null "> and hours = #{hours}</if>
            <if test="classId != null  and classId != ''"> and class_id = #{classId}</if>
            <if test="inputCode != null  and inputCode != ''"> and input_code = #{inputCode}</if>
            <if test="serialNo != null "> and serial_no = #{serialNo}</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="scheColor != null  and scheColor != ''"> and sche_color = #{scheColor}</if>
            <if test="scheType != null  and scheType != ''"> and sche_type = #{scheType}</if>
            &lt;!&ndash;and del_flag = 0&ndash;&gt;
        </where>
    </select>
-->

    <select id="selectNmisScheContrastList" parameterType="NmisScheContrast" resultMap="NmisScheContrastResult">
        <include refid="selectNmisScheContrastVo"/>
        <where>
            <if test="id != null  and id != ''"> and a.id = #{id}</if>
            <if test="groupName != null  and groupName != ''"> and a.group_name like concat(concat('%', #{groupName}), '%')</if>
            <if test="deptId != null  and deptId != ''"> and a.dept_id = #{deptId}</if>
            <if test="deptName != null  and deptName != ''"> and a.dept_name like concat('%', #{deptName}, '%')</if>
            <if test="delFlag != null  and delFlag != ''"> and a.del_flag = #{delFlag},</if>
            <if test="combId != null "> and a.id = #{combId}</if>
            <if test="scheName != null  and scheName != ''"> and sche_name like concat(concat('%', #{scheName}), '%')</if>

            <!--and del_flag = 0-->
        </where>
    </select>
</mapper>