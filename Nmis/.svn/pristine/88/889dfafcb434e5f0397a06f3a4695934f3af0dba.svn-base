<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ydl.nmis.hr.mapper.NmisHrClothesMapper">

    <resultMap type="NmisHrCoat" id="NmisHrCoatResult">
        <result property="deptName"    column="dept_name"    />
        <result property="deptId"    column="dept_id"    />
        <result property="XS"    column="XS"    />
        <result property="S"    column="S"    />
        <result property="M"    column="M"    />
        <result property="L"    column="L"    />
        <result property="XL"    column="XL"    />
        <result property="XXL"    column="XXL"    />
        <result property="XXXL"    column="XXXL"    />
    </resultMap>

    <sql id="selectNmisHrCoatVp">
        select b.dept_name,a.dept_id,
               sum(case coat_size when 'XS' then 1 else 0 end ) as  XS,
               sum(case coat_size when 'S' then 1 else 0 end ) as  S,
               sum(case coat_size when 'M' then 1 else 0 end ) as  M,
               sum(case coat_size when 'L' then 1 else 0 end ) as  L,
               sum(case coat_size when 'XL' then 1 else 0 end ) as  XL,
               sum(case coat_size when 'XXL' then 1 else 0 end ) as  XXL,
               sum(case coat_size when 'XXXL' then 1 else 0 end ) as  XXXL
        from nmis.nmis_hr_user a left join nmis.nmis_dept_dict b on a.dept_id = b.dept_id
    </sql>


    <sql id="selectNmisHrUserVo">
        select id, nurse_id, name, sex, date_of_birth, title, date_of_title, duty, date_of_duty, date_of_work, date_of_hire, political_feature, native_place, marital_status, home_address, zip_code, phone_number, next_of_kin, next_of_kin_phone, next_of_kin_addr, cert_type, cert_no, nation, email, body_weight, body_height, picture, nurse_age, register_no, register_date, register_attach, nurse_level, nurse_level_date, enter_date, level_date, leave_reason, specialty, english_level, dept_id, default_dept_id, coat_size, trouser_size, shoe_size, teach_type_id, teach_type_name, post_id, post_name, staff_type_id, staff_type_name, input_code, serial_no, status, del_flag, revision, create_id, creator, create_date, modify_id, modifier, modify_date, unit_code from nmis.nmis_hr_user
        where del_flag = 0
    </sql>

    <select id="selectNmisHrCoat" parameterType="NmisHrCoat" resultMap="NmisHrCoatResult">
        <include refid="selectNmisHrCoatVp"/>
        <where>
            <if test="deptId != null ">a.dept_id = #{deptId}</if>
            <if test="deptName != null  and deptName != ''"> and b.dept_name like CONCAT(concat('%', #{deptName}), '%')</if>
            <!--and del_flag = 0-->
        </where>
        group by  b.dept_name,a.dept_id
    </select>

</mapper>